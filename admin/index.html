<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Site Manager</title>
  </head>
  <body>
    <!--
      Admin entry using Netlify Identity + Git Gateway (git-gateway backend)
      - Ensure Netlify Identity is enabled for the site in Netlify dashboard.
      - Enable "Git Gateway" under Identity -> Services so the CMS can commit via Git Gateway.
      - This page initializes Netlify Identity and opens the login modal if an invite token is present.
    -->

    <!-- Netlify Identity widget (required for Git Gateway) -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

    <script>
      // Initialize Netlify Identity so invite_token in the URL hash is consumed.
      // If an invite token is present, open the Identity modal to complete onboarding.
      (function () {
        try {
          if (window.netlifyIdentity) {
            window.netlifyIdentity.init();

            window.netlifyIdentity.on('init', function (user) {
              try {
                var hash = window.location.hash || "";
                if (!user && hash.indexOf('invite_token=') !== -1) {
                  window.netlifyIdentity.open();
                }
              } catch (e) {
                console && console.warn && console.warn('Identity init handler error', e);
              }
            });

            // When a user logs in via the widget, refresh the page so the CMS picks up the session.
            window.netlifyIdentity.on('login', function() {
              setTimeout(function(){ window.location.reload(); }, 10);
            });
          } else {
            console && console.warn && console.warn('netlifyIdentity not available');
          }
        } catch (e) {
          console && console.warn && console.warn('Netlify Identity init failed', e);
        }
      })();
    </script>

    <!-- Decap / Netlify CMS (must be loaded after Identity widget) -->
    <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>

    <noscript>
      <p>Netlify CMS requires JavaScript. Please enable JavaScript to use the CMS.</p>
    </noscript>
  </body>
</html>